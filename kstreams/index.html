



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Kafka streaming notes - Apache Kafka Streams Samples</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#kafka-streams-getting-started" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Apache Kafka Streams Samples" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Apache Kafka Streams Samples
            </span>
            <span class="md-header-nav__topic">
              Kafka streaming notes
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/jbcodeforce/kafka-streams-samples.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Apache Kafka Streams Samples" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Apache Kafka Streams Samples
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/jbcodeforce/kafka-streams-samples.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/readme" title="Apache Kafka summary" class="md-nav__link">
      Apache Kafka summary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/consumers" title="Consumer practices" class="md-nav__link">
      Consumer practices
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://ibm-cloud-architecture.github.io/refarch-eda/kafka/producers" title="Producer practices" class="md-nav__link">
      Producer practices
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Kafka streaming notes
      </label>
    
    <a href="./" title="Kafka streaming notes" class="md-nav__link md-nav__link--active">
      Kafka streaming notes
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-1-getting-started-to-use-topologytestdriver" title="Lab 1 Getting started to use TopologyTestDriver" class="md-nav__link">
    Lab 1 Getting started to use TopologyTestDriver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mask-credit-card-number" title="mask credit card number" class="md-nav__link">
    mask credit card number
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-3-streams-with-reference-data-to-build-a-document" title="Joining 3 streams with reference data to build a document" class="md-nav__link">
    Joining 3 streams with reference data to build a document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-streams-flows-are-resilient" title="How streams flows are resilient?" class="md-nav__link">
    How streams flows are resilient?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-scale" title="How to scale?" class="md-nav__link">
    How to scale?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-readings" title="Further readings" class="md-nav__link">
    Further readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-1-getting-started-to-use-topologytestdriver" title="Lab 1 Getting started to use TopologyTestDriver" class="md-nav__link">
    Lab 1 Getting started to use TopologyTestDriver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mask-credit-card-number" title="mask credit card number" class="md-nav__link">
    mask credit card number
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-3-streams-with-reference-data-to-build-a-document" title="Joining 3 streams with reference data to build a document" class="md-nav__link">
    Joining 3 streams with reference data to build a document
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-streams-flows-are-resilient" title="How streams flows are resilient?" class="md-nav__link">
    How streams flows are resilient?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-scale" title="How to scale?" class="md-nav__link">
    How to scale?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-readings" title="Further readings" class="md-nav__link">
    Further readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/jbcodeforce/kafka-streams-samples.git/edit/master/docs/kstreams.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="kafka-streams-getting-started">Kafka Streams Getting started</h1>
<p>In this article we are presenting how to use the Kafka Streams API combined with Kafka event sourcing to implement different simple use cases.</p>
<p>The use cases are implemented inside the test folder.  Some of the domain classes are defined in the <code>src/java</code> folder. Streams topology are done in the unit test but could also be part of a service class to be used as an example running with kafka.</p>
<h2 id="lab-1-getting-started-to-use-topologytestdriver">Lab 1 Getting started to use TopologyTestDriver</h2>
<p>The goal of this first example is to understand how to use the <a href="">Kafka TopologyTestDriver API</a> to test any Kafka Streams topology. This sample is a simplest version of the Confluent example defined <a href="https://docs.confluent.io/current/streams/developer-guide/test-streams.html">here</a>.</p>
<p>Streams topology could be tested outside of Kafka run time environment using the TopologyTestDriver. Each tests define the following:</p>
<ul>
<li>a simple configuration for the test driver, input and output topics</li>
<li>a topology to test</li>
<li>a set of tests to define data to send to input topic and assertions from the output topic.</li>
</ul>
<h2 id="mask-credit-card-number">mask credit card number</h2>
<p>Using a simple kstream to change data on the fly, like for example encrypt a credit card number. Test is <a href="">EncryptCreditCardTest</a>. This is the first test to use the TopologyTestDriver class to run business logic outside of kafka. The class uses org.apache.kafka.common.serialization.Serdes and String serdesm and a JSON serdes for the domain class Purchase.</p>
<p>The other interesting approach is to use domain object with builder class and DSL to define the model:</p>
<div class="codehilite"><pre><span></span><span class="n">Purchase</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">p</span><span class="o">).</span><span class="na">maskCreditCard</span><span class="o">().</span><span class="na">build</span><span class="o">()</span>
</pre></div>

<h2 id="joining-3-streams-with-reference-data-to-build-a-document">Joining 3 streams with reference data to build a document</h2>
<p>This is a simple example of joining 3 sources of kafka streams to build a merged document, with some reference data loaded from a topic:</p>
<ul>
<li>The shipment status is a reference table and loaded inside a kafka topic: shipment-status</li>
<li>The order includes items and customer id reference</li>
<li>Customer is about the customer profile</li>
<li>Products is about products inventory. </li>
<li>The outcome is an order report document that merge most of the attributes of the 3 streams.</li>
</ul>
<h2 id="how-streams-flows-are-resilient">How streams flows are resilient?</h2>
<p>Specifying the replicas factor at the topic level, with a cluster of kafka brokers, combine with transactional event produce, ensure to do not lose messages. The producer client code has the list of all the brokers to contact in case of failure and will try to connect to any broker in the list. </p>
<h2 id="how-to-scale">How to scale?</h2>
<h2 id="further-readings">Further readings</h2>
<ul>
<li><a href="https://www.confluent.io/blog/kafka-streams-take-on-watermarks-and-triggers/">Kafka Streams’ Take on Watermarks and Triggers</a> what continuous refinement with operational parameters means: </li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>